---
const navigation = [
    { label: 'CFP', route: '/cfp' },
    { label: '√âquipe', route: '/team' },
    { label: 'Partenaires', route: '/sponsors' },
    { label: 'Code de conduite', route: '/coc' },
    { label: 'Lieu', route: '/location' },
    // { label: 'Programme', route: '/schedule' },
    // { label: 'Blog', route: '/blog' },
]

const routeName = Astro.url.pathname

const isActiveRoute = (route: string) => {
    if (route === '/') {
        return route === routeName
    }

    return routeName.startsWith(route)
}
---

<header id="site-header" class={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${routeName === '/' ? 'bg-transparent border-b-0' : 'bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-sm'}`} data-transparent={routeName === '/'}>
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-20">
            <!-- Logo -->
            <div class="flex-shrink-0">
                {routeName === '/' && <span class="text-3xl font-black text-white">Tech'Work</span>}
                {routeName !== '/' && <a href="/" class="text-3xl font-black text-gradient hover:opacity-80 transition-opacity" aria-label="Retour √† la page d'accueil">Tech'Work</a>}
            </div>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-8">
                {navigation.map((nav) => (
                    <a 
                        href={nav.route} 
                        class={`text-base font-semibold transition-colors duration-200 ${
                            routeName === '/' 
                                ? (isActiveRoute(nav.route) 
                                    ? 'text-white border-b-2 border-white pb-1' 
                                    : 'text-white/90 hover:text-white/80')
                                : (isActiveRoute(nav.route)
                                    ? 'text-primary-600 border-b-2 border-primary-600 pb-1'
                                    : 'text-gray-700 hover:text-primary-600')
                        }`}
                    >
                        {nav.label}
                    </a>
                ))}
            </nav>

            <!-- Mobile menu button -->
            <div class="md:hidden mr-5">
                <input type="checkbox" id="nav-trigger" class="sr-only" />
                <label 
                    for="nav-trigger" 
                    class={`flex items-center justify-center w-12 h-12 rounded-lg transition-colors cursor-pointer ${
                        routeName === '/' 
                            ? 'hover:bg-white/20' 
                            : 'hover:bg-gray-100'
                    }`}
                    aria-label="Ouvrir/fermer le menu de navigation"
                >
                    <svg class={`w-7 h-7 ${
                        routeName === '/' 
                            ? 'text-white' 
                            : 'text-gray-700'
                    }`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </label>

                <!-- Mobile Navigation Overlay -->
                <div class="nav-overlay fixed inset-0 bg-black/50 opacity-0 transition-opacity duration-300 ease-in-out z-50 pointer-events-none"></div>
                
                <!-- Mobile Navigation Drawer -->
                <div class="nav-drawer fixed inset-y-0 right-0 w-80 bg-white shadow-2xl transform translate-x-full transition-transform duration-500 ease-out z-60">
                    <div class="flex flex-col h-full">
                        <div class="bg-gradient-to-r from-primary-600 to-secondary-600 p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="text-2xl font-black text-white">Tech'Work</span>
                                    <p class="text-primary-100 text-sm mt-1">Lyon 2026</p>
                                </div>
                                <label for="nav-trigger" class="w-12 h-12 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors cursor-pointer">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </label>
                            </div>
                        </div>
                        <nav class="flex-1 px-0 py-0 space-y-0 bg-white">
                            {navigation.map((nav, index) => (
                                <a 
                                    href={nav.route} 
                                    class={`flex items-center px-6 py-5 text-lg font-semibold transition-all duration-300 border-b border-gray-100 hover:bg-gradient-to-r hover:from-primary-50 hover:to-secondary-50 group ${
                                        isActiveRoute(nav.route) 
                                            ? 'bg-gradient-to-r from-primary-100 to-secondary-100 text-primary-600' 
                                            : 'text-gray-700 hover:text-primary-600'
                                    }`}
                                    style={`animation-delay: ${index * 0.1}s`}
                                >
                                    <span class="mr-4 text-xl group-hover:animate-bounce-gentle">
                                        {nav.route === '/cfp' && 'üé§'}
                                        {nav.route === '/team' && 'üë•'}
                                        {nav.route === '/sponsors' && 'ü§ù'}
                                        {nav.route === '/coc' && 'ü§ù'}
                                        {nav.route === '/location' && 'üìç'}
                                    </span>
                                    {nav.label}
                                    <svg class="w-5 h-5 ml-auto text-gray-400 group-hover:text-primary-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </a>
                            ))}
                        </nav>
                        
                        <!-- Footer du menu -->
                        <div class="p-6 border-t border-gray-100 bg-gray-50">
                            <div class="text-center">
                                <p class="text-sm text-gray-500 mb-3">Rejoignez la r√©volution tech</p>
                                <div class="flex justify-center space-x-4">
                                    <a href="mailto:contact@techwork.lyon" class="w-10 h-10 bg-primary-100 text-primary-600 rounded-full flex items-center justify-center hover:bg-primary-200 transition-colors">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                                        </svg>
                                    </a>
                                    <a href="https://discord.gg/techwork-lyon" target="_blank" rel="noopener noreferrer" class="w-10 h-10 bg-secondary-100 text-secondary-600 rounded-full flex items-center justify-center hover:bg-secondary-200 transition-colors">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M8.5 6.5a.5.5 0 00-1 0v3a.5.5 0 001 0v-3zM12 6.5a.5.5 0 00-1 0v3a.5.5 0 001 0v-3z"></path>
                                            <path d="M3 4.5A1.5 1.5 0 014.5 3h11A1.5 1.5 0 0117 4.5v8A1.5 1.5 0 0115.5 14H5.707l-1.853 1.854A.5.5 0 013 15.5v-11z"></path>
                                        </svg>
                                    </a>
                                    <a href="https://twitter.com/techworklyon" target="_blank" rel="noopener noreferrer" class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center hover:bg-blue-200 transition-colors">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M6.29 18.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0020 3.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.073 4.073 0 01.8 7.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 010 16.407a11.616 11.616 0 006.29 1.84"></path>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<script>
    // Handle transparent header on scroll (only for homepage)
    function updateHeaderOnScroll() {
        const header = document.querySelector('#site-header') as HTMLElement
        if (header && window.location.pathname === '/') {
            const isTransparent = window.scrollY === 0
            header.dataset.transparent = isTransparent.toString()
            
            if (isTransparent) {
                header.className = 'fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-transparent border-b-0'
            } else {
                header.className = 'fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-sm'
            }
        }
    }
    
    window.addEventListener('scroll', updateHeaderOnScroll)

    // Handle mobile menu
    document.addEventListener('astro:page-load', () => {
        const trigger = document.querySelector('#nav-trigger') as HTMLInputElement
        const drawer = document.querySelector('.nav-drawer') as HTMLElement
        const overlay = document.querySelector('.nav-overlay') as HTMLElement
        
        if (trigger && drawer && overlay) {
            trigger.addEventListener('change', () => {
                if (trigger.checked) {
                    drawer.style.transform = 'translateX(0)'
                    overlay.style.opacity = '1'
                    overlay.style.pointerEvents = 'auto'
                    document.body.style.overflow = 'hidden'
                } else {
                    drawer.style.transform = 'translateX(100%)'
                    overlay.style.opacity = '0'
                    overlay.style.pointerEvents = 'none'
                    document.body.style.overflow = ''
                }
            })
            
            // Close menu when clicking overlay
            overlay.addEventListener('click', () => {
                trigger.checked = false
                drawer.style.transform = 'translateX(100%)'
                overlay.style.opacity = '0'
                overlay.style.pointerEvents = 'none'
                document.body.style.overflow = ''
            })
        }
    })
</script>