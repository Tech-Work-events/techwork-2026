---
import Layout from '../layouts/Layout.astro'
import { SOCIAL_DATA } from '../config'
import RoleCard from '../components/RoleCard.astro'
import TeamProfileCard from '../components/TeamProfileCard.astro'

const EVENT_DATA_URL =
    'https://storage.googleapis.com/conferencecenterr.appspot.com/events/yJJCwgGH19X4uPP9ArxV/d0f4f4c4-7f37-4772-8aea-a12db737e509.json'

interface ApiSocial {
    name: string
    icon: string
    link: string
}

interface ApiMember {
    id: string
    name: string
    photoUrl?: string
    socials?: ApiSocial[]
    role?: string
    bio?: string
    team?: string
}

let team: ApiMember[] = []

try {
    const response = await fetch(`${EVENT_DATA_URL}?t=${Date.now()}`)
    const data = await response.json()
    team = data.team || []
} catch (error) {
    console.error('Failed to fetch team data:', error)
    // Fallback to empty or handle error as needed
    team = []
}

const DISCORD_URL =
    SOCIAL_DATA.networks.find((network) => network.id === 'discord')?.url || 'https://discord.gg/techwork-lyon'

const TEAM_EMAIL = 'mailto:team@techwork.events'

type Affiliation = string

interface ProfileMeta {
    role: string
    affiliation: Affiliation
    bio: string
}

const defaultProfile: ProfileMeta = {
    role: 'BÃ©nÃ©vole',
    affiliation: 'BÃ©nÃ©vole',
    bio: 'BÃ©nÃ©vole Techâ€™Work, motivÃ© pour faire vivre un Ã©vÃ©nement utile et convivial.',
}

const teamProfiles = team
    .map((member) => {
        const linkedinUrl = member.socials?.find((s) => s.name.toLowerCase() === 'linkedin')?.link || undefined
        const twitterUrl =
            member.socials?.find((s) => s.name.toLowerCase() === 'twitter' || s.name.toLowerCase() === 'x')?.link ||
            undefined

        return {
            name: member.name,
            role: member.role || '',
            bio: member.bio || '',
            affiliation: member.team || 'BÃ©nÃ©vole',
            imageSrc: member.photoUrl ?? null,
            links: {
                linkedin: linkedinUrl,
                twitter: twitterUrl,
            },
        }
    })
    .filter((profile) => profile.name)
    .sort((a, b) => a.name.localeCompare(b.name))

const roleCards = [
    {
        title: 'Responsable Communication',
        mission: 'Faire grandir la communautÃ© Techâ€™Work et porter nos messages.',
        responsibilities: ['Social', 'Newsletter', 'RP'],
        skills: ['Marketing digital', 'Storytelling', 'Outils Social'],
    },
    {
        title: 'UX/UI Designer',
        mission: 'Faire Ã©voluer le design system et les interfaces.',
        responsibilities: ['Design System', 'Maquettes', 'Revue design'],
        skills: ['Figma/Sketch', 'Design System', 'UI/UX'],
    },
    {
        title: 'Community Manager',
        mission: 'Animer la communautÃ© avec humour et cohÃ©rence.',
        responsibilities: ['Calendrier Ã©ditorial', 'Memes', 'Interactions'],
        skills: ['Social Media', 'CrÃ©ativitÃ©', 'Copywriting'],
    },
    {
        title: 'DÃ©veloppeurÂ·se',
        mission: 'Automatiser et amÃ©liorer le site et les outils.',
        responsibilities: ['React/Astro', 'Node.js', 'Automatisation'],
        skills: ['React/Astro', 'Node.js', 'CI/CD'],
    },
]
---

<Layout
    title="Ã‰quipe Techâ€™Work Lyon â€” Organisation & Recrutement"
    description="DÃ©couvrez lâ€™Ã©quipe Techâ€™Work Lyon, la core team et les bÃ©nÃ©voles, et comment contribuer Ã  lâ€™organisation de lâ€™Ã©vÃ©nement.">
    <!-- Page Header with Hero Background -->
    <section
        class="pt-24 sm:pt-28 lg:pt-32 pb-12 sm:pb-16 lg:pb-20 bg-gradient-to-br from-gray-900 via-gray-900 to-primary-900 text-white">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="scroll-animate space-y-6">
                <p
                    class="inline-flex items-center px-4 py-2 rounded-full text-xs sm:text-sm font-semibold bg-white/10 text-gray-200">
                    <span class="mr-2" aria-hidden="true">ğŸ‘¥</span>
                    Lâ€™Ã©quipe & le collectif
                </p>
                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-black">Lâ€™Ã©quipe Techâ€™Work</h1>
                <p class="text-base sm:text-lg text-gray-200 max-w-3xl">
                    Techâ€™Work Lyon, câ€™est une core team et une garde rapprochÃ©e de bÃ©nÃ©voles qui conÃ§oivent
                    lâ€™expÃ©rience, choisissent les sujets et sâ€™assurent que tout reste humain (et un peu lama).
                </p>
                <p class="text-base sm:text-lg text-gray-200 max-w-3xl">
                    Si tu as envie de contribuer Ã  lâ€™organisation, cette page est pour toi : rÃ´les ouverts,
                    fonctionnement de lâ€™Ã©quipe et contacts.
                </p>
                <a
                    href="/"
                    class="inline-flex items-center text-sm sm:text-base text-primary-200 hover:text-white underline underline-offset-4">
                    <span aria-hidden="true" class="mr-1">â†©</span>
                    DÃ©couvrir lâ€™Ã©vÃ©nement
                </a>
            </div>
        </div>
    </section>

    <!-- Origin Story Section -->
    <section class="py-12 sm:py-16 lg:py-20 bg-white">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="scroll-animate space-y-4">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">Notre histoire (en bref)</h2>
                <p class="text-base sm:text-lg text-gray-700">
                    On a commencÃ© avec Tech & Wine : super ambiance, mais compliquÃ© Ã  dÃ©cliner en Tech & BiÃ¨re, Tech &
                    Mojito ou Tech & Jus de fruits. Lâ€™illumination est venue en rÃ©alisant que le vrai point commun, ce
                    nâ€™est pas la boisson, câ€™est le travail.
                </p>
                <p class="text-base sm:text-lg text-gray-700">
                    De lÃ  est nÃ© Techâ€™Work : un Ã©vÃ©nement pensÃ© sur temps de travail, centrÃ© sur notre mÃ©tier, pour
                    apprendre ensemble sans sacrifier ses soirs. Cette page raconte surtout qui fait tourner la machine.
                </p>
            </div>
        </div>
    </section>
    <!-- Recruitment Section -->
    <section id="join-us" class="py-16 sm:py-20 lg:py-24 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 scroll-animate">
                <div
                    class="inline-flex items-center px-4 py-2 bg-secondary-100 text-secondary-700 rounded-full text-sm font-semibold mb-6">
                    <span class="mr-2 animate-bounce-gentle">ğŸš€</span>
                    Nous recrutons
                </div>
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-black text-gray-900 mb-4">
                    Contribuer Ã  lâ€™organisation
                </h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Tous les rÃ´les sont bÃ©nÃ©voles : on cherche des personnes curieuses, fiables et partantes pour
                    co-construire lâ€™Ã©vÃ©nement, pas des super-hÃ©ros disponibles 10h par semaine.
                </p>
                <p class="mt-4 text-sm text-gray-500 max-w-2xl mx-auto">
                    Processus simple : tu nous Ã©cris, on Ã©change rapidement, puis on voit ensemble comment intÃ©grer ton
                    aide. RÃ©ponse sous quelques jours ouvrÃ©s.
                </p>
            </div>

            {
                roleCards.length > 0 && (
                    <div class="grid md:grid-cols-2 gap-6 lg:gap-8 stagger-children mb-10">
                        {roleCards.map((role) => (
                            <RoleCard
                                title={role.title}
                                mission={role.mission}
                                responsibilities={role.responsibilities}
                                skills={role.skills}
                                applyEmailHref={TEAM_EMAIL}
                                discordHref={DISCORD_URL}
                            />
                        ))}
                    </div>
                )
            }

            <p class="text-center text-sm sm:text-base text-gray-600 max-w-2xl mx-auto">
                Tu ne te reconnais pas dans ces rÃ´les mais tu as envie dâ€™aider ? Ã‰cris-nous quand mÃªme : on trouve
                souvent une faÃ§on utile de contribuer.
            </p>
        </div>
    </section>

    <!-- Team Profiles Section -->
    <section id="team-members" class="py-16 sm:py-20 lg:py-24 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 scroll-animate">
                <h2 class="text-3xl sm:text-4xl font-black text-gray-900 mb-4">La core team & les bÃ©nÃ©voles</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                    DerriÃ¨re Techâ€™Work, il y a une petite Ã©quipe qui coordonne, prÃ©pare les contenus et veille Ã  ce que
                    la journÃ©e se passe bien pour tout le monde.
                </p>
            </div>

            {
                teamProfiles.length > 0 ? (
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8 stagger-children">
                        {teamProfiles.map((profile) => (
                            <TeamProfileCard
                                name={profile.name}
                                role={profile.role}
                                bio={profile.bio}
                                imageSrc={profile.imageSrc}
                                affiliation={profile.affiliation}
                                links={profile.links}
                            />
                        ))}
                    </div>
                ) : (
                    <p class="text-center text-gray-500 text-sm">
                        On prÃ©pare encore la galerie de lâ€™Ã©quipe. En attendant, Ã©cris-nous si tu veux en savoir plus.
                    </p>
                )
            }
        </div>
    </section>

    <!-- Contact Section -->
    <section class="py-12 sm:py-16 lg:py-20 bg-gradient-to-r from-primary-50 to-secondary-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="scroll-animate-scale text-center">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4">Nous contacter</h2>
                <p class="text-base sm:text-lg text-gray-700 mb-6">
                    Une question sur lâ€™organisation, envie de filer un coup de main ou besoin dâ€™en savoir plus avant de
                    te lancer ?
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a
                        href={TEAM_EMAIL}
                        class="btn btn-primary text-sm sm:text-base px-6 py-3 hover-lift group"
                        aria-label="Rejoindre lâ€™Ã©quipe (contact email)"
                        data-cta
                        data-placement="team-contact-primary">
                        <span class="mr-2 group-hover:animate-bounce-gentle" aria-hidden="true">ğŸ“§</span>
                        Rejoindre lâ€™Ã©quipe
                    </a>
                    <a
                        href={DISCORD_URL}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="btn btn-secondary text-sm sm:text-base px-6 py-3 hover-lift group"
                        aria-label="Rejoindre la communautÃ© Discord"
                        data-cta
                        data-placement="team-contact-discord">
                        <span class="mr-2 group-hover:animate-bounce-gentle" aria-hidden="true">ğŸ’¬</span>
                        Discord communautÃ©
                    </a>
                </div>
                <p class="text-xs text-gray-500 mt-4 italic">
                    On lit tous les messages et on essaie de rÃ©pondre rapidement (promis, entre deux blagues de lama).
                </p>
            </div>
        </div>
    </section>
</Layout>
